<!doctype html>
<html lang="es">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- RESET elimina los estilos css que implementan los navegadores por defecto-->
    <link rel="stylesheet" href="./assets/css/reset200802.css">


    <!--jQuery -->
    <!-- MORRIS JS libreria para realizar graficas-->
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
    <link rel="stylesheet" href="./assets/libs/morris.js-0.5.1/morris.css">
    <script src="./assets/libs/morris.js-0.5.1/morris.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>



    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous">
    </script>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.24/fc-3.3.2/fh-3.1.8/r-2.2.7/sc-2.0.3/datatables.min.css"/>

    <!-- Hoja de estilos del sitio-->
    <link rel="stylesheet" href="./assets/css/stilo.css">


    <title>Mi escuela | Alumnos</title>

    <style>
       
    </style>
</head>

<body>

    <div class="container">
        <div class="row">
            <div class="col-12 col-md-6 ordenar1">
                <div id="chart"></div>
            </div>
            <div class="col-12 col-md-6 tabla-contenedor ordenar2">
                <table id="dt-table">
                    <thead>
                        <tr>
                            <th>AÃ±os</th>
                            <th>Ganacias</th>
                            <th>Compradores</th>
                            <th>Edad compradors</th>
                            <th>Defectos</th>
                            <th>Eliminar</th>
                        </tr>
                    </thead>

                </table>
            </div>
        </div>
    </div>
    <!--  Popper.js, then Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"
        integrity="sha384-SR1sx49pcuLnqZUnnPwx6FCym0wLsk5JZuNx2bPPENzswTNFaQU1RDvt3wT4gWFG" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.min.js"
        integrity="sha384-j0CNLUeiqtyaRmlzUHCPZ+Gy5fQu0dQ6eZ/xAww941Ai1SxSY+0EQqNXNE6DZiVc" crossorigin="anonymous">
    </script>
    <!-- para  la tabla--> 
    
    <script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.24/fc-3.3.2/fh-3.1.8/r-2.2.7/sc-2.0.3/datatables.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>


    <script>
        let draw = false;

        init();

        /**
         * FUNCTIONS
         */
        function init() {
            // initialize DataTables
            const table = $("#dt-table").DataTable({
                paging: false,
                "ordering": false,
                reponsive: true,
                "ajax": "./assets/json/file-json-tabla.json",
                "columnDefs": [{
                    "targets": -1,
                    "data": null,
                    "defaultContent": "<input type='button' class='borrar btn' value='Eliminar' />"
                }]
            });
            // get table data
            const tableData = getTableData(table);
            // create Highcharts
            createHighcharts(tableData);
            // table events
            setTableEvents(table);
        }

        function getTableData(table) {
            const dataArray = [],
                countryArray = [],
                populationArray = [],
                densityArray = [],
                defectosArray = [];

            // loop table rows
            table.rows({
                search: "applied"
            }).every(function () {
                const data = this.data();
                countryArray.push(data[0]);
                populationArray.push(parseInt(data[1].replace(/\,/g, "")));
                densityArray.push(parseInt(data[2].replace(/\,/g, "")));
                defectosArray.push(parseInt(data[3].replace(/\,/g, "")));
            });

            // store all data in dataArray
            dataArray.push(countryArray, populationArray, densityArray, defectosArray);

            return dataArray;
        }

        function createHighcharts(data) {
            Highcharts.setOptions({
                lang: {
                    thousandsSep: ","
                }
            });

            Highcharts.chart("chart", {
                title: {
                    text: "Tabla Titulo"
                },
                subtitle: {
                    text: ""
                },
                xAxis: [{
                    categories: data[0],
                    labels: {
                        rotation: -45
                    }
                }],
                yAxis: [{
                        // first yaxis
                        title: {
                            text: "Ganancias"
                        }
                    },
                    {
                        // secondary yaxis
                        title: {
                            text: "Usuarios"
                        },
                        min: 0,
                        opposite: true
                    }
                ],
                series: [{
                        name: "Ganancias",
                        color: "#0071A7",
                        type: "spline",
                        data: data[1],
                        tooltip: {
                            valueSuffix: " M"
                        }
                    },
                    {
                        name: "Usuarios",
                        color: "#FF404E",
                        type: "spline",
                        data: data[2],
                        yAxis: 1
                    },
                    {
                        name: "Defectos",
                        color: "#000",
                        type: "spline",
                        data: data[3],
                        yAxis: 1
                    }
                ],
                
                tooltip: {
                    shared: true
                },
                legend: {
                    backgroundColor: "#ececec",
                    shadow: true
                },
                credits: {
                    enabled: false
                },
                noData: {
                    style: {
                        fontSize: "16px"
                    }
                }
            });
        }

        function setTableEvents(table) {
            // listen for page clicks
            table.on("page", () => {
                draw = true;
            });

            // listen for updates and adjust the chart accordingly
            table.on("draw", () => {
                if (draw) {
                    draw = false;
                } else {
                    const tableData = getTableData(table);
                    createHighcharts(tableData);
                }
            });

            $(document).on('click', '.borrar', function (event) {

                table.row($(this).parents('tr')).remove().draw(false);
                const tableData = getTableData(table);
                createHighcharts(tableData);
            });
        }
    //sticky
        $("#dt-table").delegate( "thead tr th", "click", function(event) {
       if($(this).hasClass("sticky-column")== false){
            $("table thead tr th").each(function () {
                $(this).removeClass('sticky-column');
            });

            $(this).addClass('sticky-column');
            let pos = $(this).index()
            $("table tbody tr").each(function () {
                $("td").removeClass('sticky-column');
            });

            $("table tbody tr").each(function () {
                $(this).find("td:eq(" + (pos) + ")").addClass('sticky-column');
            });
        }
        else{
            $("table thead tr th").each(function () {
                $(this).removeClass('sticky-column');
            });
            $("table tbody tr").each(function () {
                $("td").removeClass('sticky-column');
            });
        }
    });
    </script>
    <!--<script src="./assets/js/floating-select.js"></script>
 <script src="./assets/js/graficas.js"></script>
 <script src="./assets/js/crear-json.js"></script>-->

 <!--modernizr ayuda a compatibilizar nuestro codigo con otros navegadores-->
 <script src="./assets/js/modernizr-custom.js"></script>
</body>

</html>